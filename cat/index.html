<!-- simple redirect to cdn2.thecatapi.com/images/[id].jpg -->
<!-- usage: https://www.tomcat.sh/cat/?!=id                -->
<head>
  <meta property="og:title" content="Tomcat's Cats" />
  <meta property="og:description" content="Get a random cat image!" />
  <meta id="og-image" property="og:image" content="" />
  <title>Random Cat</title>
</head>
<body>
  <p id="status">loading...</p>
  <img id="cat-img" style="max-width:100%;display:none;" />
  <a onclick="copy();" href="#" style="display: none;" id="copy">copy cat</a>
  <script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const id = urlParams.get("!");
    const ogImage = document.querySelector('meta[property="og:image"]');
    const status = document.getElementById('status');
    const catImg = document.getElementById('cat-img');
    const copyEl = document.getElementById('copy');

    function setEmbed(url) {
      ogImage.setAttribute("content", url);
      catImg.src = url;
      catImg.style.display = "block";
      status.textContent = "Here's your cat!";
      copyEl.style.display = "block";
    }

    async function copy() {
      const url = catImg.src.replace("https://cdn2.thecatapi.com/images/", "").replace(".jpg", "");
      await navigator.clipboard.writeText("https://www.tomcat.sh/cat/?!=" + url);
      copyEl.innerText = "copied!";
      setTimeout(() => {
        copyEl.innerText = "copy cat";
      }, 1000);
    }

    if (id) {
      const imgUrl = "https://cdn2.thecatapi.com/images/" + id + (id.includes(".gif") ? "" : ".jpg");
      setEmbed(imgUrl);
    } else {
      fetch("https://api.thecatapi.com/v1/images/search")
        .then(response => response.json())
        .then(data => {
          if (data && data[0] && data[0].url) {
            setEmbed(data[0].url);
          } else {
            status.textContent = "Could not load cat image.";
          }
        });
    }
  </script>

</body>

